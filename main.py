# -*- coding: utf-8 -*-
import streamlit as st
import pandas as pd

# -------------------------------
# ê¸°ë³¸ ì„¤ì •
# -------------------------------
st.set_page_config(
    page_title="í†µê³„ x ì—‘ì…€ ì‹¤ìŠµì‹¤",
    page_icon="ðŸ“Š",
    layout="wide"
)

st.title("ðŸ“Š í†µê³„ x ì—‘ì…€ ì‹¤ìŠµì‹¤")
st.caption("ì¤‘í•™êµ 3í•™ë…„ Â· í†µê³„ ë°°ìš°ê³  ì—‘ì…€ í•¨ìˆ˜ë¡œ ì§ì ‘ ê³„ì‚°í•´ ë³´ê¸°")

# -------------------------------
# ì˜ˆì‹œ ë°ì´í„° (33ëª… ìˆ˜í•™ ì ìˆ˜)
# -------------------------------
DEFAULT_DATA = [
    {"ë²ˆí˜¸": 1, "ìˆ˜í•™": 95},
    {"ë²ˆí˜¸": 2, "ìˆ˜í•™": 37},
    {"ë²ˆí˜¸": 3, "ìˆ˜í•™": 92},
    {"ë²ˆí˜¸": 4, "ìˆ˜í•™": 62},
    {"ë²ˆí˜¸": 5, "ìˆ˜í•™": 87},
    {"ë²ˆí˜¸": 6, "ìˆ˜í•™": 43},
    {"ë²ˆí˜¸": 7, "ìˆ˜í•™": 94},
    {"ë²ˆí˜¸": 8, "ìˆ˜í•™": 79},
    {"ë²ˆí˜¸": 9, "ìˆ˜í•™": 81},
    {"ë²ˆí˜¸": 10, "ìˆ˜í•™": 71},
    {"ë²ˆí˜¸": 11, "ìˆ˜í•™": 91},
    {"ë²ˆí˜¸": 12, "ìˆ˜í•™": 91},
    {"ë²ˆí˜¸": 13, "ìˆ˜í•™": 97},
    {"ë²ˆí˜¸": 14, "ìˆ˜í•™": 61},
    {"ë²ˆí˜¸": 15, "ìˆ˜í•™": 96},
    {"ë²ˆí˜¸": 16, "ìˆ˜í•™": 37},
    {"ë²ˆí˜¸": 17, "ìˆ˜í•™": 93},
    {"ë²ˆí˜¸": 18, "ìˆ˜í•™": 84},
    {"ë²ˆí˜¸": 19, "ìˆ˜í•™": 87},
    {"ë²ˆí˜¸": 20, "ìˆ˜í•™": 87},
    {"ë²ˆí˜¸": 21, "ìˆ˜í•™": 78},
    {"ë²ˆí˜¸": 22, "ìˆ˜í•™": 94},
    {"ë²ˆí˜¸": 23, "ìˆ˜í•™": 87},
    {"ë²ˆí˜¸": 24, "ìˆ˜í•™": 68},
    {"ë²ˆí˜¸": 25, "ìˆ˜í•™": 85},
    {"ë²ˆí˜¸": 26, "ìˆ˜í•™": 80},
    {"ë²ˆí˜¸": 27, "ìˆ˜í•™": 7},
    {"ë²ˆí˜¸": 28, "ìˆ˜í•™": 75},
    {"ë²ˆí˜¸": 29, "ìˆ˜í•™": 82},
    {"ë²ˆí˜¸": 30, "ìˆ˜í•™": 97},
    {"ë²ˆí˜¸": 31, "ìˆ˜í•™": 90},
    {"ë²ˆí˜¸": 32, "ìˆ˜í•™": 93},
    {"ë²ˆí˜¸": 33, "ìˆ˜í•™": 96},
]

df = pd.DataFrame(DEFAULT_DATA)
scores = df["ìˆ˜í•™"].astype(float)
mean = scores.mean()
var = scores.var(ddof=1) if len(scores) > 1 else 0

# ì •ë‹µ í™•ì¸ìš©: íŽ¸ì°¨, íŽ¸ì°¨ì˜ ì œê³±, ë“±ìˆ˜
df_answer = df.copy()
df_answer["íŽ¸ì°¨"] = df_answer["ìˆ˜í•™"] - mean
df_answer["íŽ¸ì°¨ì˜ ì œê³±"] = df_answer["íŽ¸ì°¨"] ** 2
df_answer["ë“±ìˆ˜"] = scores.rank(ascending=False, method="min").astype(int)

import streamlit.components.v1 as components

# -------------------------------
# ì‚¬ì´ë“œë°”: ìˆ˜ì—… ìˆœì„œ ì•ˆë‚´
# -------------------------------
with st.sidebar:
    st.header("ðŸ§­ ìˆ˜ì—… ìˆœì„œ ì•ˆë‚´")

    st.markdown(
        """
### â‘  ì ìˆ˜ ë°ì´í„° í™•ì¸í•˜ê¸°  
- ì•„ëž˜ í‘œì˜ ë²ˆí˜¸â€“ìˆ˜í•™ ì ìˆ˜ë¥¼ ì—‘ì…€ì— ê·¸ëŒ€ë¡œ ìž…ë ¥

### â‘¡ ì „ì²´ í‰ê·  êµ¬í•˜ê¸°  
- `=AVERAGE(B2:B34)` ë¡œ ì „ì²´ í‰ê·  ê³„ì‚°í•˜ê¸°

### â‘¢ íŽ¸ì°¨ ê³„ì‚°í•˜ê¸°  
- Cì—´ì— `íŽ¸ì°¨ = ì ìˆ˜ - ì „ì²´í‰ê· `  
- ì˜ˆ: `=B2-$B$36` ìž…ë ¥ í›„ C34ê¹Œì§€ ìžë™ ì±„ìš°ê¸°

### â‘£ íŽ¸ì°¨ì˜ ì œê³± ê³„ì‚°í•˜ê¸°  
- Dì—´ì— `=C2^2` ìž…ë ¥ í›„ D34ê¹Œì§€ ìžë™ ì±„ìš°ê¸°

### â‘¤ ë¶„ì‚° ê°œë… ì—°ê²°í•˜ê¸°  
- íŽ¸ì°¨ì˜ ì œê³± í‰ê· ì´ ë¶„ì‚°  
- ì—‘ì…€ì—ì„œ `=VAR.S(B2:B34)` ë¡œ í™•ì¸í•˜ê¸°

### â‘¥ ì—‘ì…€ í•¨ìˆ˜í‘œ ë³´ê¸°  
- í‰ê·  / ì¤‘ê°„ê°’ / ìµœë¹ˆê°’ / ë¶„ì‚° / COUNTIF ì •ë¦¬í‘œ

### â‘¦ ì—‘ì…€ í•¨ìˆ˜ ë¯¸ë‹ˆí€´ì¦ˆ í’€ê¸°  
- í•¨ìˆ˜ ì´ë¦„ì„ ë§ží˜€ ë³´ë©° ì •ë¦¬
        """
    )
    st.markdown("---")
    st.caption("TIP : êµì‚¬ëŠ” í•„ìš”í•  ë•Œë§Œ ì •ë‹µ(íŽ¸ì°¨Â·ë“±ìˆ˜) í‘œë¥¼ íŽ¼ì³ì„œ í™•ì¸í•˜ì„¸ìš”.")
# -------------------------------
# 1. ìˆ˜í•™ ì ìˆ˜ ë°ì´í„° ë³´ê¸°
# -------------------------------
st.subheader("1. ìˆ˜í•™ ì ìˆ˜ ë°ì´í„° ë³´ê¸°")

# ê¸°ë³¸ ì˜ˆì‹œ ì ìˆ˜ëŠ” ì•± ì•ˆì—ì„œ í•œ ë²ˆ ë³´ì—¬ì£¼ê¸°
st.write("ì—‘ì…€Â·êµ¬ê¸€ ì‹œíŠ¸ì— ì˜®ê²¨ì„œ ì‚¬ìš©í•  ì˜ˆì‹œ ìˆ˜í•™ ì ìˆ˜ìž…ë‹ˆë‹¤.")
st.dataframe(df, use_container_width=True)
st.info("êµ¬ê¸€ ì‹œíŠ¸ì—ì„œëŠ” Aì—´ì— ë²ˆí˜¸, Bì—´ì— ìˆ˜í•™, Cì—´ì— íŽ¸ì°¨, Dì—´ì— íŽ¸ì°¨ì˜ ì œê³±ì„ ë‘ê³  í™œë™í•©ë‹ˆë‹¤.")

# í•™ìƒë“¤ì´ ì§ì ‘ ìž…ë ¥í•  êµ¬ê¸€ ì‹œíŠ¸ URL
sheet_url = "https://docs.google.com/spreadsheets/d/1j1XreiCNo-A07oH595yMF4ZNhNyFW04whArRgaNIugs/edit?usp=sharing"

st.markdown("### êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ì§ì ‘ í‰ê· Â·íŽ¸ì°¨ ê³„ì‚°í•´ ë³´ê¸°")
st.markdown(
    """
ì•„ëž˜ì— ì—°ê²°ëœ êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ

- Bì—´ì— ì ìˆ˜ë¥¼ í™•ì¸í•˜ê³   
- ë§¨ ì•„ëž˜ ì…€ì— `=AVERAGE(B2:B34)` ë¡œ **ì „ì²´ í‰ê· **ì„ ì§ì ‘ êµ¬í•œ ë’¤  
- Cì—´ì— `=B2-$B$35` ì™€ ê°™ì´ **íŽ¸ì°¨**,  
- Dì—´ì— `=C2^2` ë¡œ **íŽ¸ì°¨ì˜ ì œê³±**ì„ ê³„ì‚°í•´ ë³´ì„¸ìš”.
"""
)

# ìƒˆ ì°½ìœ¼ë¡œ ì—´ ìˆ˜ ìžˆëŠ” ë§í¬ë„ ì œê³µ
st.markdown(f"[êµ¬ê¸€ ì‹œíŠ¸ë¥¼ ìƒˆ ì°½ìœ¼ë¡œ ì—´ê¸°]({sheet_url})")

# ì•± ì•ˆì— ë°”ë¡œ ì‹œíŠ¸ë¥¼ ìž„ë² ë“œ
components.iframe(sheet_url, height=600, scrolling=True)

# êµì‚¬ìš© ì •ë‹µ í‘œ
with st.expander("ì •ë‹µ í™•ì¸ìš© (íŽ¸ì°¨Â·íŽ¸ì°¨ì˜ ì œê³±Â·ë“±ìˆ˜ê¹Œì§€ ë³´ê¸°)"):
    st.dataframe(df_answer, use_container_width=True)
    st.caption("ìˆ˜ì—… ì¤‘ì—ëŠ” ë‹«ì•„ë‘ê³ , êµì‚¬ìš© í™•ì¸ìš©ìœ¼ë¡œë§Œ ì‚¬ìš©í•˜ë©´ ì¢‹ìŠµë‹ˆë‹¤.")

# -------------------------------
# 2. ì—‘ì…€ í•¨ìˆ˜ ì •ë¦¬í‘œ
# -------------------------------

st.subheader("2. ì—‘ì…€ì—ì„œ ë˜‘ê°™ì´ ê³„ì‚°í•´ ë³´ê¸°")

st.markdown(
"""
ì•„ëž˜ í‘œëŠ” ì´ ìˆ˜ì—…ì—ì„œ ì‚¬ìš©í•  ì£¼ìš” ì—‘ì…€ í•¨ìˆ˜ ì •ë¦¬ìž…ë‹ˆë‹¤.
ì‹¤ì œ ì‹œíŠ¸ì—ì„œ ë°”ë¡œ ì—°ìŠµí•  ìˆ˜ ìžˆë„ë¡ ì˜ˆì‹œ ìˆ˜ì‹ê¹Œì§€ ë„£ì–´ ë‘ì—ˆìŠµë‹ˆë‹¤.
"""
)

excel_table = pd.DataFrame(
{
"ê°œë…": [
"ì „ì²´ í‰ê· ",
"ì¤‘ê°„ê°’",
"ìµœë¹ˆê°’",
"ë¶„ì‚°(í‘œë³¸)",
"90ì  ì´ìƒ ì¸ì› ìˆ˜",
"59ì  ì´í•˜ ì¸ì› ìˆ˜",
],
"ì—‘ì…€ í•¨ìˆ˜": [
"AVERAGE",
"MEDIAN",
"MODE.SNGL",
"VAR.S",
"COUNTIF",
"COUNTIF",
],
"ì˜ˆì‹œ ìˆ˜ì‹": [
"=AVERAGE(B2:B34)",
"=MEDIAN(B2:B34)",
"=MODE.SNGL(B2:B34)",
"=VAR.S(B2:B34)",
'=COUNTIF(B2:B34,">=90")',
'=COUNTIF(B2:B34,"<=59")',
],
"ì„¤ëª…": [
"ì „ì²´ ì ìˆ˜ì˜ í‰ê· (ì‚°ìˆ í‰ê· )ì„ êµ¬í•¨",
"ìž‘ì€ ìˆœì„œë¡œ ì •ë ¬í–ˆì„ ë•Œ ê°€ìš´ë° ê°’",
"ê°€ìž¥ ë§Žì´ ë‚˜ì˜¨ ì ìˆ˜",
"ì ìˆ˜ë“¤ì´ í‰ê· ì—ì„œ ì–¼ë§ˆë‚˜ í¼ì ¸ ìžˆëŠ”ì§€ (í‘œë³¸ ë¶„ì‚°)",
"90ì  ì´ìƒ(A ì„±ì )ì¸ í•™ìƒ ìˆ˜ë¥¼ ì…ˆ",
"59ì  ì´í•˜ì¸ í•™ìƒ ìˆ˜ë¥¼ ì…ˆ",
],
}
)

st.dataframe(excel_table, use_container_width=True)

# -------------------------------
# 3. ì—‘ì…€ í•¨ìˆ˜ ë¯¸ë‹ˆ í€´ì¦ˆ
# -------------------------------

st.subheader("3. ì—‘ì…€ í•¨ìˆ˜ ë¯¸ë‹ˆ í€´ì¦ˆ")

st.markdown("ì—‘ì…€ ì‹œíŠ¸ë¥¼ ì´ìš©í•´ì„œ í€´ì¦ˆë¥¼ ë§žì¶°ë³´ì„¸ìš”.")

# Q1 ì „ì²´ í‰ê· 

st.markdown("Q1. ì „ì²´í‰ê· ì€? \nìˆ˜í•™ ì ìˆ˜ì˜ ì „ì²´ í‰ê· ì„ êµ¬í•˜ë©´?(ì†Œìˆ˜ë‘˜ì§¸ìžë¦¬ê¹Œì§€ ì ìœ¼ì„¸ìš”.)")
q1 = st.text_input("ìˆ˜í•™ ì ìˆ˜ì˜ ì „ì²´ í‰ê· ì„ êµ¬í•˜ëŠ” í•¨ìˆ˜ ì˜ˆ: AVERAGE / MAX / MIN ì¤‘ í•˜ë‚˜", key="q1")
if q1:
    if q1.strip().upper() == "78.69":
        st.success("ì •ë‹µ! ì „ì²´ í‰ê· ì€ AVERAGE í•¨ìˆ˜ë¡œ êµ¬í•©ë‹ˆë‹¤.")
    else:
        st.error("ì „ì²´ í‰ê· ì€ AVERAGE í•¨ìˆ˜ë¡œ êµ¬í•©ë‹ˆë‹¤.")

st.markdown("---")

# Q2 ì¤‘ì•™ê°’

st.markdown("Q2. ì¤‘ì•™ê°’ì€? \nì ìˆ˜ë¥¼ ìž‘ì€ ìˆœì„œëŒ€ë¡œ ì •ë ¬í–ˆì„ ë•Œ '12ë²ˆì§¸ ê°’'ì„ êµ¬í•˜ë©´?")
q2 = st.text_input("ì ìˆ˜ë¥¼ ìž‘ì€ ìˆœì„œëŒ€ë¡œ ì •ë ¬í–ˆì„ ë•Œ 'ê°€ìš´ë° ê°’'ì„ êµ¬í•˜ëŠ” í•¨ìˆ˜ ì˜ˆ: MEDIAN / MODE.SNGL / ...", key="q2")
if q2:
    if q2.strip().upper() == "87":
        st.success("ì •ë‹µ! ì¤‘ì•™ê°’ì€ MEDIAN í•¨ìˆ˜ë¡œ êµ¬í•©ë‹ˆë‹¤.")
    else:
        st.error("ì¤‘ì•™ê°’ì€ MEDIAN í•¨ìˆ˜ìž…ë‹ˆë‹¤.")

st.markdown("---")

# Q3 ìµœë¹ˆê°’

st.markdown("Q3. ìµœë¹ˆê°’ì€? \nê°€ìž¥ ë§Žì´ ë‚˜ì˜¨ ì ìˆ˜ë¥¼ êµ¬í•˜ë©´?")
q3 = st.text_input("ê°€ìž¥ ë§Žì´ ë‚˜ì˜¨ ì ìˆ˜ë¥¼ êµ¬í•˜ëŠ” í•¨ìˆ˜ ì˜ˆ: MODE.SNGL / AVERAGE / ...", key="q3")
if q3:
    if q3.strip().upper() == "87":
        st.success("ì •ë‹µ! ìµœë¹ˆê°’ì€ MODE.SNGL í•¨ìˆ˜ë¡œ êµ¬í•©ë‹ˆë‹¤.")
    else:
        st.error("ìµœë¹ˆê°’ì€ MODE.SNGL í•¨ìˆ˜ìž…ë‹ˆë‹¤.")

st.markdown("---")

# Q4 ë¶„ì‚°

st.markdown("Q4. ë¶„ì‚°ì€? \nì ìˆ˜ë“¤ì´ í‰ê· ì—ì„œ ì–¼ë§ˆë‚˜ í¼ì ¸ ìžˆëŠ”ì§€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” 'ë¶„ì‚°'ì„ êµ¬í•˜ë©´?(ìžì—°ìˆ˜ìœ¼ë¡œë§Œí‘œí˜„í•˜ì‹œì˜¤.)")
q4 = st.text_input("ì ìˆ˜ë“¤ì´ í‰ê· ì—ì„œ ì–¼ë§ˆë‚˜ í¼ì ¸ ìžˆëŠ”ì§€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” 'ë¶„ì‚°'ì„ êµ¬í•˜ëŠ” í•¨ìˆ˜ ì˜ˆ: VAR.S / STDEV.S / ...", key="q4")
if q4:
    if q4.strip().upper() == ["425"]:
        st.success("ì •ë‹µ! ë¶„ì‚°ì€ VAR.S í•¨ìˆ˜ë¡œ êµ¬í•©ë‹ˆë‹¤.")
    else:
        st.error("ë¶„ì‚°(í‘œë³¸)ì„ êµ¬í•  ë•ŒëŠ” VAR.S í•¨ìˆ˜ë¥¼ ì£¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.")

st.markdown("---")

# Q5 90ì  ì´ìƒ

st.markdown("Q5. ì„±ì (90ì  ì´ìƒ)ì€ ëª‡ ëª…ì¸ê°€? \n90ì  ì´ìƒ í•™ìƒ ìˆ˜ëŠ”?(ë‹¨ìœ„ë¥¼ ìƒëžµí•´ì£¼ì„¸ìš”.)")
q5 = st.text_input("90ì  ì´ìƒ í•™ìƒ ìˆ˜ë¥¼ ì…€ ë•Œ ì‚¬ìš©í•  í•¨ìˆ˜ ì˜ˆ: COUNT / COUNTIF / SUM", key="q5")
if q5:
    if q5.strip().upper() == "14":
        st.success("ì •ë‹µ! ì¡°ê±´ì´ ìžˆì„ ë•ŒëŠ” COUNTIF í•¨ìˆ˜ë¡œ ê°œìˆ˜ë¥¼ ì…‰ë‹ˆë‹¤.")
    else:
        st.error("ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ê°œìˆ˜ë¥¼ ì…€ ë•ŒëŠ” COUNTIF í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.")

st.markdown("---")

# Q6 59ì  ì´í•˜

st.markdown("Q6. 59ì  ì´í•˜ëŠ” ëª‡ ëª…ì¸ê°€? \n59ì  ì´í•˜ í•™ìƒ ìˆ˜ëŠ”?(ë‹¨ìœ„ë¥¼ ìƒëžµí•´ì£¼ì„¸ìš”.)")
q6 = st.text_input("59ì  ì´í•˜ í•™ìƒ ìˆ˜ë¥¼ ì…€ ë•Œë„ ê°™ì€ í•¨ìˆ˜ ì˜ˆ: COUNT / COUNTIF / SUM", key="q6")
if q6:
    if q6.strip().upper() == "4":
        st.success('ì •ë‹µ! ì—¬ê¸°ì„œë„ COUNTIF í•¨ìˆ˜ìž…ë‹ˆë‹¤. ì˜ˆ: =COUNTIF(B2:B34,"<=59")')
    else:
        st.error("ì¡°ê±´ì´ ìžˆëŠ” ê°œìˆ˜ ì„¸ê¸°ëŠ” ëª¨ë‘ COUNTIF í•¨ìˆ˜ìž…ë‹ˆë‹¤.")

st.markdown(
    """
ížŒíŠ¸)  
5ë²ˆ í•™ìƒì˜ ì ìˆ˜ëŠ” **87ì **ì´ë©°,  
RANK.EQ í•¨ìˆ˜ì—ì„œ ë§ˆì§€ë§‰ ì¸ìˆ˜ 0ì€ **ë‚´ë¦¼ì°¨ìˆœ(ì ìˆ˜ ë†’ì„ìˆ˜ë¡ 1ë“±)**ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

ì˜ˆì‹œ ìˆ˜ì‹:
```excel
=RANK.EQ(B5, $B$2:$B$34, 0)


"""
)

q7 = st.text_input("5ë²ˆ í•™ìƒì˜ ë“±ìˆ˜ë¥¼ ìˆ«ìžë¡œ ìž…ë ¥í•´ë³´ì„¸ìš”.", key="q7")

if q7:
try:
if int(q7.strip()) == 14:
st.success("ì •ë‹µ! 5ë²ˆ í•™ìƒì€ 14ë“±ìž…ë‹ˆë‹¤. (ë™ì ìž ì—¬ëŸ¬ ëª… í¬í•¨)")
else:
st.error("ì•„ì‰½ìŠµë‹ˆë‹¤! ì •ë‹µì€ 14ë“± ìž…ë‹ˆë‹¤.")
except:
st.error("ìˆ«ìžë¡œ ìž…ë ¥í•´ì£¼ì„¸ìš”.")


---

# ðŸ“Œ **ì •ë‹µ í•´ì„¤**
- 87ì ì¸ í•™ìƒì€ ì´ 4ëª… (5ë²ˆ, 19ë²ˆ, 20ë²ˆ, 23ë²ˆ)
- ë™ì ìžëŠ” ëª¨ë‘ **ê°™ì€ ë“±ìˆ˜(14ë“±)** ì„ ë°›ìŒ  
- `RANK.EQ(B5, $B$2:$B$34, 0)` â†’ ë‚´ë¦¼ì°¨ìˆœ, ì ìˆ˜ í° í•™ìƒì¼ìˆ˜ë¡ 1ë“±

---

st.caption("í†µê³„ x ì—‘ì…€ ì‹¤ìŠµì‹¤: í‰ê·  â†’ íŽ¸ì°¨ â†’ ë¶„ì‚°ì„ ì—‘ì…€ë¡œ ì—°ê²°í•´ ë³´ëŠ” ìˆ˜ì—…ìš© ì•±ìž…ë‹ˆë‹¤.")
